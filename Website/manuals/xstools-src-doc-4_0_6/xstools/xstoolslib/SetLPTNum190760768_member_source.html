<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - SetLPTNum</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">SetLPTNum</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','xstoolslib0',this)" class="pathLink">xstoolslib</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_class','PPort0',this)" class="pathLink">PPort</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">SetLPTNum</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','SetLPTNum190760768','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','SetLPTNum190760768','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','SetLPTNum190760768','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 210</div>
<pre class="codeExamples">
bool <a href="#" OnFocus="link('_member','SetLPTNum190760768',this)">PPort::SetLPTNum</a>(unsigned int n)
{
    <a href="#" OnFocus="link('_member','num57972',this)">num</a> = (n &lt;= <a href="#" OnFocus="link('_member','maxPortNum0',this)">maxPortNum</a>) ? n : 1; // set parallel port number to 1 if n is a hardware address instead of port #
    
    // find the I/O address for the given parallel port
    if(n &lt;= <a href="#" OnFocus="link('_member','maxPortNum0',this)">maxPortNum</a>)
    {
        char s[20];
        sprintf(s,"LPT%1dADDRESS",n);
        string paramName(s);
        <a href="#" OnFocus="link('_member','address57972',this)">address</a> = 0;
        sscanf(<a href="#" OnFocus="link('_member','GetXSTOOLSParameter67554305',this)">GetXSTOOLSParameter</a>(paramName).c_str(),"%x",&amp;address);
//      string lptAddress;
//      if((lptAddress=GetXSTOOLSParameter((string)s)) != "")
//      {
//          istrstream argstr((char*)lptAddress.c_str());
//          argstr &gt;&gt; address;
//      }
    }
    else
        <a href="#" OnFocus="link('_member','address57972',this)">address</a> = n;
    
    switch(<a href="#" OnFocus="link('_member','IODriverIndex57972',this)">IODriverIndex</a>)
    {
    case <a href="#" OnFocus="link('_member','TVICHW320',this)">TVICHW32</a>:
        if(<a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a>==0)
        { // only activate the driver if it is currently inactive
#ifdef TVICHW_VERSION_6_0
            <a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a> = OpenTVicHW();
#else // TVICHW versions 5.x and earlier
            <a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a> = OpenTVicHW32(PPort::HW32, "TVICHW32","TVicDevice0");
            if(<a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a>==0 || !GetActiveHW(PPort::HW32))
                <a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a> = OpenTVicHW32(PPort::HW32, "TVICHW32","TVicDevice1");
#endif
            // handle the case where the driver can't be started
            if(<a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a>==0)
                <a href="#" OnFocus="link('_member','err57972',this)">err</a>-&gt;<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMinor,"ERRLOC: All TVicHW32 handles are in use!!\n");
            else if(!GetActiveHW(PPort::HW32))
            {
                <a href="#" OnFocus="link('_member','err57972',this)">err</a>-&gt;<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMinor,"ERRLOC: All TVicHW32 handles are in use!!\n");
                <a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a> = 0;
            }
        }
        if(<a href="#" OnFocus="link('_member','HW3257972',this)">PPort::HW32</a>!=0)
        {
            if((n&lt;=GetLPTNumPorts(PPort::HW32)) &amp;&amp; (<a href="#" OnFocus="link('_member','address57972',this)">address</a>==0))
            {
                SetLPTNumber(PPort::HW32,n);
                <a href="#" OnFocus="link('_member','address57972',this)">address</a> = GetLPTBasePort(PPort::HW32);
                // Use soft access for higher speeds.  This is needed to generate
                // timed waveforms like those used to program Atmel serial EEPROMs
                // and Dallas programable oscillators.
                SetHardAccess(PPort::HW32,FALSE);
            }
            else
            {
                if(n &lt;= <a href="#" OnFocus="link('_member','maxPortNum0',this)">maxPortNum</a>)
                    SetLPTNumber(PPort::HW32,n);
                else
                    SetLPTNumber(PPort::HW32,1);
                SetHardAccess(PPort::HW32,FALSE);
            }
        }
        break;
    case <a href="#" OnFocus="link('_member','DRIVERLINX0',this)">DRIVERLINX</a>:
        {
            if(<a href="#" OnFocus="link('_member','address57972',this)">address</a> == 0)
            {
                char lptAddresses[8];
                PhysicalMemory lptAddrBlock(0x00000408,8,false);
                lptAddrBlock.readMemoryBlock((void*)lptAddresses,8, 0);
                <a href="#" OnFocus="link('_member','address57972',this)">address</a> = (lptAddresses[(<a href="#" OnFocus="link('_member','num57972',this)">num</a>-1)*2+1]&lt;&lt;8) + lptAddresses[(<a href="#" OnFocus="link('_member','num57972',this)">num</a>-1)*2];
            }
            break;
        }
    case <a href="#" OnFocus="link('_member','UNIIO0',this)">UNIIO</a>:
    default:
        {
            if(<a href="#" OnFocus="link('_member','address57972',this)">address</a> == 0)
            {
                char lptAddresses[8];
                PhysicalMemory lptAddrBlock(0x00000408,8,false);
                lptAddrBlock.readMemoryBlock((void*)lptAddresses,8, 0);
                <a href="#" OnFocus="link('_member','address57972',this)">address</a> = (lptAddresses[(<a href="#" OnFocus="link('_member','num57972',this)">num</a>-1)*2+1]&lt;&lt;8) + lptAddresses[(<a href="#" OnFocus="link('_member','num57972',this)">num</a>-1)*2];
            }
            OSInterface&amp; o = OSInterface::osinterface(); // this just gets the driver running on WinNT, 2000, XP
            <a href="#" OnFocus="link('_member','dataPort57972',this)">dataPort</a> = new IOPort(address,true);        // writeable data port
            <a href="#" OnFocus="link('_member','statusPort57972',this)">statusPort</a> = new IOPort(address+1,false); // readable status port
            <a href="#" OnFocus="link('_member','controlPort57972',this)">controlPort</a> = new IOPort(address+2,true);  // writeable control 
            assert((dataPort!=NULL) &amp;&amp; (statusPort!=NULL) &amp;&amp; (controlPort!=NULL));
            break;
        }
    }
    
    if(<a href="#" OnFocus="link('_member','address57972',this)">address</a>==0)
        return false;   // return false if no parallel port is at this address

    return true;        // return true if a parallel port was found
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
