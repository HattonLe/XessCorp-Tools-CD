<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - GetXSTOOLSParameter</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">GetXSTOOLSParameter</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','xstoolslib0',this)" class="pathLink">xstoolslib</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">GetXSTOOLSParameter</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','GetXSTOOLSParameter67554305','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','GetXSTOOLSParameter67554305','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','GetXSTOOLSParameter67554305','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 451</div>
<pre class="codeExamples">
string <a href="#" OnFocus="link('_member','GetXSTOOLSParameter67554305',this)">GetXSTOOLSParameter</a>(string &amp;name)
{
    <a href="#" OnFocus="link('_class','XSError0',this)">XSError</a> <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>(cerr);
    string msg;
    char fileValString[512];
    char regValString[512];
    DWORD regValLength = 0;
    
#ifdef _WINDOWS
    // check the registry for the parameter
    HKEY appKey;
    DWORD keyDisp;
    DWORD valType;
    if(RegCreateKeyEx(HKEY_CURRENT_USER,"SOFTWARE\\XESS",0,NULL,REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,NULL,&amp;appKey,&amp;keyDisp) == ERROR_SUCCESS)
    {
        regValLength = 512;
        if(RegQueryValueEx(appKey,name.c_str(),0,&amp;valType,(unsigned char*)regValString,&amp;regValLength) == ERROR_SUCCESS)
        {
            assert(valType==REG_SZ);
            regValString[regValLength] = 0; // terminate string read from registry
        }
        else
            regValLength = 0;
        RegCloseKey(appKey);
    }
#endif
    // check the XS parameter file
    fileValString[0] = 0;   // start off by clearing the value string from the XS parameter file
    string XSTOOLSParameterFilename = (string)<a href="#" OnFocus="link('_member','FindXSTOOLSBinDir53616',this)">FindXSTOOLSBinDir</a>() + (string)"/XSPARAM.TXT";
    FILE* fp = fopen(XSTOOLSParameterFilename.c_str(),"r");
    if(fp == NULL)
    {
        msg = "XSTOOLS parameter file (" + XSTOOLSParameterFilename + (string)") could not be opened!!\n";
        <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
    }
    else
    {
        char line[512];
        while(fgets(line,511,fp) != NULL)
        {
            // got a line of text.  now see if it starts with the name we are searching for...
            char nm[512];
            int n = sscanf(line,"%s %s",nm,fileValString);
            if(n==0 || n==EOF)
                continue;   // skip blank lines
            if(n != 2)
            {
                msg = (string)"Corrupted record encountered while reading XSTOOLS parameter file (" + XSTOOLSParameterFilename + (string)"):\n";
                msg += (string)line;
                <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
                break;
            }
            if((string)nm == name)
                break;  // found the parameter name.  now return the parameter value...
            // otherwise keep searching through the parameter text file...
            fileValString[0] = 0; // clear any crap from the fileValString
        }
        fclose(fp);
    }
    if(regValLength==0) return fileValString;   // return value from file if registry value is null
    else return regValString;                   // else return value from registry
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
