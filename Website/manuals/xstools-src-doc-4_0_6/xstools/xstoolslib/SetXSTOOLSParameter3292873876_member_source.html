<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - SetXSTOOLSParameter</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">SetXSTOOLSParameter</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','xstoolslib0',this)" class="pathLink">xstoolslib</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">SetXSTOOLSParameter</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','SetXSTOOLSParameter3292873876','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','SetXSTOOLSParameter3292873876','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','SetXSTOOLSParameter3292873876','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 379</div>
<pre class="codeExamples">
bool <a href="#" OnFocus="link('_member','SetXSTOOLSParameter3292873876',this)">SetXSTOOLSParameter</a>(string &amp;name, string &amp;value)
{
    <a href="#" OnFocus="link('_class','XSError0',this)">XSError</a> <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>(cerr);
    string msg;
    
#ifdef _WINDOWS
    // check the registry for the parameter value and set it if found
    HKEY appKey;
    DWORD keyDisp;
    
    if(RegCreateKeyEx(HKEY_CURRENT_USER,"SOFTWARE\\XESS",0,NULL,REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,NULL,&amp;appKey,&amp;keyDisp) == ERROR_SUCCESS)
    {
        RegSetValueEx(appKey,name.c_str(),0,REG_SZ,(const unsigned char*)(value.c_str()),value.length());
        RegCloseKey(appKey);
    }
#endif
    // remove the parameter value from the XSPARAM file and replace it at the end of the file with a new value
    char* lines[1000];
    string XSTOOLSParameterFilename = (string)<a href="#" OnFocus="link('_member','FindXSTOOLSBinDir53616',this)">FindXSTOOLSBinDir</a>() + (string)"/XSPARAM.TXT";
    FILE* fp = fopen(XSTOOLSParameterFilename.c_str(),"r");
    int numLines=0;
    if(fp != NULL)
    {
        char line[512], val[512];
        for(int i=0; fgets(line,511,fp) != NULL; i++)
        {
            char nm[512];
            int n = sscanf(line,"%s %s",nm,val);
            if(n==0 || n==EOF)
                continue;   // skip blank lines
            if(n != 2)
            {
                msg = (string)"Corrupted record encountered while reading XSTOOLS parameter file (" + XSTOOLSParameterFilename + (string)"):\n";
                msg += (string)line;
                <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
                fclose(fp);
                return false;
            }
            if((string)nm != name)  // store lines that don't match line to be replaced
                lines[numLines++] = strdup(line);
        }
        fclose(fp);
    }
    fp = fopen(XSTOOLSParameterFilename.c_str(),"w");
    if(fp == NULL)
    {
        msg = "XSTOOLS parameter file (" + XSTOOLSParameterFilename + (string)") could not be opened!!\n";
        <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
        return false;
    }
    for(int j=0; j&lt;numLines; j++)
    {
        fprintf(fp,"%s",lines[j]);
        free(lines[j]);
    }
    fprintf(fp,"%s %s\n",name.c_str(),value.c_str());
    fclose(fp);
    return true;
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
