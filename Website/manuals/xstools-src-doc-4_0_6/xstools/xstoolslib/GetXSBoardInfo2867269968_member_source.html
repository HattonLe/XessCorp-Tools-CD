<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - GetXSBoardInfo</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">GetXSBoardInfo</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','xstoolslib0',this)" class="pathLink">xstoolslib</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">GetXSBoardInfo</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','GetXSBoardInfo2867269968','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','GetXSBoardInfo2867269968','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','GetXSBoardInfo2867269968','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 517</div>
<pre class="codeExamples">
int <a href="#" OnFocus="link('_member','GetXSBoardInfo2867269968',this)">GetXSBoardInfo</a>(<a href="#" OnFocus="link('_class','brdModel_struct0',this)">XSBoardInfo</a> **bInfo)
{
    <a href="#" OnFocus="link('_class','XSError0',this)">XSError</a> <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>(cerr);
    static int numBoards=0;
    static <a href="#" OnFocus="link('_class','brdModel_struct0',this)">XSBoardInfo</a>* brdInfo=NULL;

    // return board info already read from file on a previous call to this subroutine
    if(numBoards &gt; 0)
    {
        *bInfo = brdInfo;
        return numBoards;
    }

    // otherwise, read board info from file and store it in data structure
    const char* whitespace = " \t\n\f\r";
    string msg;
    string XSBoardInfoFilename = (string)<a href="#" OnFocus="link('_member','FindXSTOOLSBinDir53616',this)">FindXSTOOLSBinDir</a>() + (string)"/XSBRDINF.TXT";
    FILE* fp = fopen(XSBoardInfoFilename.c_str(),"r");
    if(fp == NULL)
    {
        msg = "XS Board information file (" + XSBoardInfoFilename + (string)") could not be opened!!\n";
        <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
        brdInfo = NULL;
        numBoards = 0;
        *bInfo = brdInfo;
        return numBoards;
    }

    char *line, *field;
    while(!feof(fp))
    {
        if((line = (char*)malloc(512)) == NULL)
        {
            msg = (string)"Ran out of memory while reading entries from the XS Board information file (" + XSBoardInfoFilename + (string)")\n";
            <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
            numBoards = 0;
            if(brdInfo!=NULL)
                free(brdInfo);
            brdInfo = NULL;
            fclose(fp);
            *bInfo = brdInfo;
            return numBoards;
        }
        if(fgets(line,512,fp) == NULL)
        {
            if(feof(fp))
            {
                free(line);
                fclose(fp);
                *bInfo = brdInfo;
                return numBoards;
            }
            msg = (string)"File error encountered while reading XS Board information file (" + XSBoardInfoFilename + (string)")\n";
            <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
            numBoards = 0;
            if(brdInfo!=NULL)
                free(brdInfo);
            brdInfo = NULL;
            free(line);
            fclose(fp);
            *bInfo = brdInfo;
            return numBoards;
        }

        if((field = strtok(line,whitespace)) == NULL)
        {
            free(line);
            continue;   // skip blank lines
        }
        if(*field == '#')
        {
            free(line);
            continue;   // skip comments
        }

        if((brdInfo = (<a href="#" OnFocus="link('_class','brdModel_struct0',this)">XSBoardInfo</a>*)realloc(brdInfo, (numBoards+1) * sizeof(<a href="#" OnFocus="link('_class','brdModel_struct0',this)">XSBoardInfo</a>))) == NULL)
        {
            msg = (string)"Ran out of memory while reading records from XS Board information file (" + XSBoardInfoFilename + (string)")\n";
            <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(<a href="#" OnFocus="link('_member','XSErrorMajor0',this)">XSErrorMajor</a>,msg);
            numBoards = 0;
            if(brdInfo!=NULL)
                free(brdInfo);
            brdInfo = NULL;
            free(line);
            fclose(fp);
            *bInfo = brdInfo;
            return numBoards;
        }
        brdInfo[numBoards].<a href="#" OnFocus="link('_member','brdModel1254770407',this)">brdModel</a> = field;

        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].chipType = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
            {
                msg = (string)"Missing inversion mask for " + brdInfo[numBoards].brdModel + (string)" in XS Board information file (" + XSBoardInfoFilename + (string)")\n";
                <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(<a href="#" OnFocus="link('_member','XSErrorMajor0',this)">XSErrorMajor</a>,msg);
                numBoards = 0;
                if(brdInfo!=NULL)
                    free(brdInfo);
                brdInfo = NULL;
                free(line);
                fclose(fp);
                *bInfo = brdInfo;
                return numBoards;
            }
            sscanf(field,"%x",&amp;(brdInfo[numBoards].invMask));
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].dwnldIntfcBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].ramBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].oscBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].eraseBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].flashBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].flashConfigBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].testIntfcBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].testBitstreamFile = field;
        }
        if((field = strtok(NULL,whitespace)) != NULL)
        {
            if(!strcmp(field,"NULL"))
                field[0] = 0;   // null any unused fields
            brdInfo[numBoards].testObjFile = field;
        }
        else
        {   // if the last field was not read correctly, then an error occurred in that field
            // or one of the earlier fields
            msg = (string)"File error encountered while reading fields of XS Board information file (" + XSBoardInfoFilename + (string)")\n";
            <a href="#" OnFocus="link('_member','../xsi2c/err0',this)">err</a>.<a href="#" OnFocus="link('_member','SimpleMsg3476940419',this)">SimpleMsg</a>(XSErrorMajor,msg);
            numBoards = 0;
            if(brdInfo!=NULL)
                free(brdInfo);
            brdInfo = NULL;
            free(line);
            fclose(fp);
            *bInfo = brdInfo;
            return numBoards;
        }

        numBoards++;
    }

    fclose(fp);
    *bInfo = brdInfo;
    return numBoards;
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
