<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - OnDropFiles</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">OnDropFiles</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','gxsload0',this)" class="pathLink">gxsload</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_class','CGxsloadDlg0',this)" class="pathLink">CGxsloadDlg</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">OnDropFiles</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','OnDropFiles715474125','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','OnDropFiles715474125','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','OnDropFiles715474125','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 502</div>
<pre class="codeExamples">
afx_msg void <a href="#" OnFocus="link('_member','OnDropFiles715474125',this)">CGxsloadDlg::OnDropFiles</a>(HDROP hDropInfo)
{
    // determine which list box the files are dropped into
    POINT dropPoint;
    if(::DragQueryPoint(hDropInfo,&amp;dropPoint) == 0)
        return; // dropped outside of client area so do nothing

    // determine which list box the files were dropped into
    enum {FPLD,RAM,NONVOL} listType;
    CListBox* fileListBox;
    WINDOWPLACEMENT wFPLD, wRAM, wNONVOL;
    <a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetWindowPlacement(&amp;wFPLD);
    <a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetWindowPlacement(&amp;wRAM);
    <a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetWindowPlacement(&amp;wNONVOL);
    if(wFPLD.rcNormalPosition.left&lt;=dropPoint.x &amp;&amp; dropPoint.x&lt;=wFPLD.rcNormalPosition.right &amp;&amp;
        wFPLD.rcNormalPosition.top&lt;=dropPoint.y &amp;&amp; dropPoint.y&lt;=wFPLD.rcNormalPosition.bottom)
    {
        fileListBox = &amp;<a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>;
        listType = FPLD;
    }
    else if(wRAM.rcNormalPosition.left&lt;=dropPoint.x &amp;&amp; dropPoint.x&lt;=wRAM.rcNormalPosition.right &amp;&amp;
        wRAM.rcNormalPosition.top&lt;=dropPoint.y &amp;&amp; dropPoint.y&lt;=wRAM.rcNormalPosition.bottom)

    {
        fileListBox = &amp;<a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>;
        listType = RAM;
    }
    else if(wNONVOL.rcNormalPosition.left&lt;=dropPoint.x &amp;&amp; dropPoint.x&lt;=wNONVOL.rcNormalPosition.right &amp;&amp;
        wNONVOL.rcNormalPosition.top&lt;=dropPoint.y &amp;&amp; dropPoint.y&lt;=wNONVOL.rcNormalPosition.bottom)
    {
        fileListBox = &amp;<a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>;
        listType = NONVOL;
    }
    else
        return; // dropped outside of file list boxes so do nothing

    
    int numFiles = ::DragQueryFile(hDropInfo, (UINT) -1, NULL, 0); // # of dropped files
    int i;
    for(i=numFiles-1; i&gt;=0; i--)
    {
        // get the name of the next dropped file
        char <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>[MAX_PATH];
        ::DragQueryFile(hDropInfo,i,<a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>,sizeof(<a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>));

        // make the file name into a string
        string* file = new string(fileName);

        // check the file name a suffix of a downloadable file
        string suffix = <a href="#" OnFocus="link('_member','../xstoolslib/GetSuffix67554305',this)">GetSuffix</a>(*file);
        for( int l=suffix.length()-1; l&gt;=0; l--)
            suffix[l] = toupper(suffix[l]);
        if( (listType==FPLD   &amp;&amp; (suffix!="BIT" &amp;&amp; suffix!="SVF")) ||
            (listType==RAM    &amp;&amp; (suffix!="HEX" &amp;&amp; suffix!="EXO" &amp;&amp; suffix!="XES" &amp;&amp; suffix!="MCS")) ||
            (listType==NONVOL &amp;&amp; (suffix!="HEX" &amp;&amp; suffix!="EXO" &amp;&amp; suffix!="XES" &amp;&amp; suffix!="MCS" &amp;&amp; suffix!="BIT"))
            )
        {
            numFiles--; // decrement the number of downloadable files
            continue;   // skip non-downloadable files
        }

        // get the directory path to the downloadable file
        string* dir = new string;
        *dir = <a href="#" OnFocus="link('_member','../xstoolslib/GetPrefix67554305',this)">GetPrefix</a>(*file);

        // get the base file name
        <a href="#" OnFocus="link('_member','../xstoolslib/StripPrefix67554305',this)">StripPrefix</a>(*file);

        // show the base file name in the list box and associate a
        // pointer to the directory path with the list item
        fileListBox-&gt;InsertString(0,file-&gt;data());
        fileListBox-&gt;SetItemDataPtr(0,dir);
    }
    ::DragFinish(hDropInfo);

    if(numFiles&lt;=0)
    {
        AfxMessageBox("No downloadable files dropped!!",MB_ICONSTOP);
        return;
    }

    // deselect all files ...
    if(fileListBox-&gt;SetSel(-1,FALSE) == LB_ERR)
        fileListBox-&gt;SetCurSel(-1);  // do this if the list box allows only a single selection
    // then select the newly added downloadable files
    if(numFiles&lt;2)
    {
        if(fileListBox-&gt;SetSel(0,TRUE) == LB_ERR)
            fileListBox-&gt;SetCurSel(0);  // do this if the list box allows only a single selection
    }
    else if(fileListBox-&gt;SelItemRange(TRUE,0,numFiles-1) == LB_ERR)
            fileListBox-&gt;SetCurSel(0);  // do this if the list box allows only a single selection

    <a href="#" OnFocus="link('_member','OnSelchangeLstFiles183903484',this)">OnSelchangeLstFiles</a>();
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
