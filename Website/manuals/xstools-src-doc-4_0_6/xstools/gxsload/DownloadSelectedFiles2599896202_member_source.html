<HTML>
<HEAD>
<TITLE>XSTOOLs Source Code - DownloadSelectedFiles</TITLE>
<script type="text/javascript" src="../../common/js.js" language="JavaScript"></script>
<script type="text/javascript" src="leftmenu.js" language="JavaScript"></script>
<script type="text/javascript">
 var relPathToCommmon = "../../common/";
 var relPathToHelpDir = "../../common/help/";
 var toSearchPage     = "_search','../../search";
 Body1();
</script>
<div class="headerPage">DownloadSelectedFiles</div>
<div class="path"><a href="#" OnFocus="link('','../../index',this)" class="pathLink">XSTOOLs</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_dir','gxsload0',this)" class="pathLink">gxsload</A><img src="../../common/path-arrow.gif" class="path-arrow"><a href="#" OnFocus="link('_class','CGxsloadDlg0',this)" class="pathLink">CGxsloadDlg</A><img src="../../common/path-arrow.gif" class="path-arrow"><span class="pathNonLink">DownloadSelectedFiles</span></div>
<script type="text/javascript">
 Body2();
 BodyLeftMenuStart();
WriteLeftMenu("","","","");
 BodyLeftMenuEnd();
 Body3();
</script>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','DownloadSelectedFiles2599896202','_description',this)" class="tabLinkInActive">Description</a></span>
<span class="tabActive"><a href="#" OnFocus="linkTab('_member','DownloadSelectedFiles2599896202','_source',this)" class="tabLinkActive">Source</a></span>
<span class="tabInActive"><a href="#" OnFocus="linkTab('_member','DownloadSelectedFiles2599896202','_callgraph',this)" class="tabLinkInActive">Call Graph</a></span>
<script type="text/javascript">
 Body4();
</script>
<div class="contentAirTop"></div>
<div class="paragraph2NoTopPadding">Start Line: 375</div>
<pre class="codeExamples">
void <a href="#" OnFocus="link('_member','DownloadSelectedFiles2599896202',this)">CGxsloadDlg::DownloadSelectedFiles</a>(void)
{
    
    <a href="#" OnFocus="link('_class','../xstoolslib/XSError0',this)">XSError</a> <a href="#" OnFocus="link('_member','../xsusb/errMsg0',this)">errMsg</a>(cerr); // setup error channel

    // exit if no files selected for downloading
    if(<a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetSelCount()==0 &amp;&amp; <a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetSelCount()==0 &amp;&amp; <a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetSelCount()==0)
    {
        AfxMessageBox("No files selected to download!", MB_ICONSTOP);
        return;
    }

    int <a href="#" OnFocus="link('_member','../xsatapi/portNum0',this)">portNum</a> = <a href="#" OnFocus="link('_member','m_cmbLpt183903365',this)">m_cmbLpt</a>.GetCurSel()+1;  // get parallel port number

    // determine the type of XS Board and set the pointer to the board object
    <a href="#" OnFocus="link('_class','../xstoolslib/XSBoard0',this)">XSBoard</a>* <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
    CString <a href="#" OnFocus="link('_member','../xsatapi/brdModel0',this)">brdModel</a>;
    <a href="#" OnFocus="link('_member','m_cmbBoard183903365',this)">m_cmbBoard</a>.GetLBText(<a href="#" OnFocus="link('_member','m_cmbBoard183903365',this)">m_cmbBoard</a>.GetCurSel(),<a href="#" OnFocus="link('_member','../xsatapi/brdModel0',this)">brdModel</a>);
    <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a> = <a href="#" OnFocus="link('_member','../xstoolslib/NewXSBoard189216495',this)">NewXSBoard</a>(brdModel);
    if(<a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>==NULL)
    {
        AfxMessageBox("Unknown type of XS Board!", MB_ICONSTOP);
        return;
    }

    if(<a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>-&gt;<a href="#" OnFocus="link('_member','../xstoolslib/Setup3588776655',this)">Setup</a>(&amp;errMsg,LPCTSTR(brdModel),portNum) == false)
    {
        AfxMessageBox("Invalid parallel port selected!",MB_ICONSTOP);
        delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
        return;
    }

    // if any files in the RAM list are selected, then download them into RAM
    if(<a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetSelCount() != 0)
    {
        bool ramIntfcDownload = (<a href="#" OnFocus="link('_member','m_ramIntfcDownload183903365',this)">m_ramIntfcDownload</a>.GetCheck()==BST_CHECKED);
        int index[10];  // holds the indices of selected files
        int numFiles = <a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetSelItems(10,index);  // get indices of selected files
        char <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>[MAX_PATH];
        for(int i=0; i&lt;numFiles; i++)
        {
            string dirAndFileName;
            dirAndFileName = *(string*)(<a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetItemDataPtr(index[i]));
            <a href="#" OnFocus="link('_member','m_lstRAM183903365',this)">m_lstRAM</a>.GetText(index[i],fileName);
            dirAndFileName += "/";
            dirAndFileName += <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>;
            if(<a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>-&gt;<a href="#" OnFocus="link('_member','../xstoolslib/DownloadRAM785046615',this)">DownloadRAM</a>(dirAndFileName, ENDIAN_DEFAULTS, (i==0)&amp;&amp;ramIntfcDownload, i==numFiles-1) == false)
            {
                string instructions = "An error occurred while downloading to the RAM\n\nContinue?";
                if(<a href="#" OnFocus="link('_member','../xstoolslib/PromptUser2517124797',this)">PromptUser</a>(instructions,PROMPT_OKCANCEL) == <a href="#" OnFocus="link('_member','../xstoolslib/RESPONSE_CANCEL0',this)">RESPONSE_CANCEL</a>)
                {
                    delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
                    return;
                }
            }
            else if(<a href="#" OnFocus="link('_member','../xsatapi/errMsg0',this)">errMsg</a>.<a href="#" OnFocus="link('_member','../xstoolslib/IsError863564933',this)">IsError</a>())
            {
                string instructions = "An error occurred while downloading to the RAM\n\nContinue?";
                if(<a href="#" OnFocus="link('_member','../xstoolslib/PromptUser2517124797',this)">PromptUser</a>(instructions,PROMPT_OKCANCEL) == <a href="#" OnFocus="link('_member','../xstoolslib/RESPONSE_CANCEL0',this)">RESPONSE_CANCEL</a>)
                {
                    delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
                    return;
                }
            }
        }
    }

    // if any files in the FlashEEPROM list are selected, then download them into Flash/EEPROM
    if(<a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetSelCount() != 0)
    {
        bool flashIntfcDownload = (<a href="#" OnFocus="link('_member','m_flashIntfcDownload183903365',this)">m_flashIntfcDownload</a>.GetCheck()==BST_CHECKED);
        int index[10];  // holds the indices of selected files
        int numFiles = <a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetSelItems(10,index);  // get indices of selected files
        char <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>[MAX_PATH];
        for(int i=0; i&lt;numFiles; i++)
        {
            string dirAndFileName;
            dirAndFileName = *(string*)(<a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetItemDataPtr(index[i]));
            <a href="#" OnFocus="link('_member','m_lstNONVOL183903365',this)">m_lstNONVOL</a>.GetText(index[i],<a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>);
            dirAndFileName += "/";
            dirAndFileName += <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>;
            if(<a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>-&gt;<a href="#" OnFocus="link('_member','../xstoolslib/DownloadFlash785046615',this)">DownloadFlash</a>(dirAndFileName, ENDIAN_DEFAULTS, (i==0)&amp;&amp;flashIntfcDownload, i==numFiles-1) == false)
            {
                string instructions = "An error occurred while downloading to the Flash\n\nContinue?";
                if(<a href="#" OnFocus="link('_member','../xstoolslib/PromptUser2517124797',this)">PromptUser</a>(instructions,<a href="#" OnFocus="link('_member','../xstoolslib/PROMPT_OKCANCEL0',this)">PROMPT_OKCANCEL</a>) == <a href="#" OnFocus="link('_member','../xstoolslib/RESPONSE_CANCEL0',this)">RESPONSE_CANCEL</a>)
                {
                    delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
                    return;
                }
            }
            else if(<a href="#" OnFocus="link('_member','../xsatapi/errMsg0',this)">errMsg</a>.<a href="#" OnFocus="link('_member','../xstoolslib/IsError863564933',this)">IsError</a>())
            {
                string instructions = "An error occurred while downloading to the Flash\n\nContinue?";
                if(<a href="#" OnFocus="link('_member','../xstoolslib/PromptUser2517124797',this)">PromptUser</a>(instructions,PROMPT_OKCANCEL) == <a href="#" OnFocus="link('_member','../xstoolslib/RESPONSE_CANCEL0',this)">RESPONSE_CANCEL</a>)
                {
                    delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
                    return;
                }
            }
        }
    }

    // if any file in the FPGA/CPLD list is selected, then download it into RAM
    if(<a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetCurSel() != LB_ERR)
    {
        char <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>[MAX_PATH];
        int i = <a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetCurSel();
        string dirAndFileName = *(string*)(<a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetItemDataPtr(i));
        <a href="#" OnFocus="link('_member','m_lstFPLD183903365',this)">m_lstFPLD</a>.GetText(i,fileName);
        dirAndFileName += "/";
        dirAndFileName += <a href="#" OnFocus="link('_member','../xssetsaa711X/fileName0',this)">fileName</a>;
        if(<a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>-&gt;<a href="#" OnFocus="link('_member','../xstoolslib/Configure36592665',this)">Configure</a>(dirAndFileName) == false)
        {
            delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
            return;
        }
        else if(<a href="#" OnFocus="link('_member','../xsatapi/errMsg0',this)">errMsg</a>.<a href="#" OnFocus="link('_member','../xstoolslib/IsError863564933',this)">IsError</a>())
        {
            delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
            return;
        }
    }

    delete <a href="#" OnFocus="link('_member','../gxssetcodec/brdPtr0',this)">brdPtr</a>;
}
</pre><div class="contentAirBottom"></div>
<script type="text/javascript">
 Body5();
Statistics("","","","","");
 Body6();
SetPageTab('_member','_source');
</script>
